<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carrito de Compras</title>
</head>
<body>
    <h1>Mi Carrito</h1>

    {{#if cartItems.length}}
    <ul>
      {{#each cartItems}}
    <div>
        <h2>{{this.productName}}</h2>
        <p>Precio: ${{this.productPrice}}</p>
        <p>Cantidad: {{this.quantity}}</p>
        <p>Total por producto: ${{this.totalPrice}}</p>

        <!-- Botón para eliminar el producto -->
        <button type="button" onclick="eliminarProducto('{{this.productId}}')">Eliminar del carrito</button>
    </div>
    {{/each}}
    </ul>

    <h3>Total del Carrito: ${{total}}</h3>
    {{else}}
    <p>Tu carrito está vacío.</p>
    {{/if}}

    <a href="/">Volver a la lista de productos</a>

    <script>
        // Función para eliminar el producto usando 'fetch'
        function eliminarProducto(productId) {
            // Depuración: Verifica los valores que se están pasando
            console.log("Product ID:", productId);  // Verifica que productId esté correctamente asignado

            // Confirma con el usuario si está seguro de eliminar el producto
            if (confirm('¿Estás seguro de eliminar este producto?')) {
                // Realiza la solicitud DELETE usando fetch
                fetch(`/api/carts/products/${productId}`, {
                    method: 'DELETE',
                })
                .then(response => {
                    // Si la respuesta es exitosa (status 200)
                    if (response.ok) {
                        alert('Producto eliminado del carrito');
                        // Recargar la página para actualizar el carrito
                        window.location.reload();
                    } else {
                        alert('Hubo un problema al eliminar el producto');
                    }
                })
                .catch(error => {
                    // Maneja cualquier error que pueda ocurrir
                    console.error('Error al eliminar el producto:', error);
                    alert('Error al eliminar el producto');
                });
            }
        }
    </script>
</body>
</html>





